# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура


Код приложения разделен на слои согласно паттерну MVP. 
 - слой представления отвечает за отоброжение данных.
 - слой данных отвечает за хранение и изменение. 
 - презентер, отвечает за связь представления и данных.

### Класс API 

 Этот класс представляет основу для взаимодействия с сервером. Поддерживает базовые методы GET, POST, DELETE. А также класс обрабатывает ответы с сервера. 

 Класс содержит методы: 


- `handleResponse` - Логика обработки ответа с сервера. Проверка статуса ответа, в случае, если приходит ответ, но ключ ok является ложным - вызываем ошибку через rejected. 
- `get` - Метод, принимающий параметр (uri), возвращает запрос на сервер с методом _GET_.
- `post`- Метод, принимающий 3 параметра (uri, data, method). Где, Data - тело запроса, также возвращает fetch запрос с методоми  _POST_, _DELETE_, _PUT_. В случае если не передали метод, при вызове по умолчанию _POST_ (default).  



### Класс EventEmitter 
#### Брокер событий позволяет подписываться, а также отписываться от событий, происходящих в системе. Класс используется в приложении для генерации событий. Основные методы, реализуемые классом описаны в интерфейсе `IEvents`:

- `on` - Метод, позваляющий осуществить подписку на событие. 
- `off` - Метод, отписаться от события. 
- `emit` - Метод, позволяющий осуществить событие с данными.
- `onAll` - Метод, для прослушивания всех событий. 
- `offAll` - Метод, чтобы сбросить прослушивания со всех событий.
- `trigger` - Метод, создающий коллбек триггер, генерирующий событие при вызове.


## Данные и типы данных, используемые в приложении. 


- Товар


```
interface IProductItem {
    id: string;
    description: string;
    title: string;
    image: string;
    category: string;
    price: number;
};
```

- Товар в корзине

```
interface IProductCartItem {
  id: string;
  title: string;
  price: number;
}
```

- Корзина

```
interface IBasketView {
    items: IProductCartItem[];
    totalPrice: number;
};
```

- Доставка (адрес / способ оплаты)

```
interface IDeliveryInfo {
    address: string;
    payment: string
};
```

- Контакты (Эл. почта / телефон)

```
interface IContactInfo {
    email: string;
    telephone: string
};
```

- Успешный заказ

```
interface ISuccessOrder {
    totalPrice: number;
};
```

- События в корзине

```
interface IBasketData {
    items: IProductCartItem[];
    addItem(item:IProductItem): => void;
    removeItem(item:IProductItem): => void;
    clearBasket(): => void
}
```

## Класс Form 
### Для создания форм, обрабатывает ввод и проверяет заполненные данные. Также в этом классе мы добавляем обработчики событий на input и button.

#### Поля класса:

\_submit - HTML элемент, кнопка с типом submit
\_errors - HTML элемент, span, с выводом текста ошибки.

#### Методы:

 - `onChangeInputText` - метод, который добавляет обработчик событий на input.
 - `setValid` - метод, который валидирует введенные данные.
 - `setErrors` - метод, который отрисовывает ошибку после валидации, если введенный текст не соответствует паттерну.
 - `render` - метод, который рендарит (отрисовывает) элементы формы.

## Класс Component 
### Класс для компонентов пользовательского интерфейса. Представляет собой абстрастрактный класс, на основе которого базируются все остальные компоненты интерфейса. Он представляет общие методы для управления DOM элементами, такие как переключение классов, установка текстового содержимого компонента или его изображения. 

#### Методы:

- `toggleClass` - метод для переключения класса.
- `setText` - метод для установки текста для html тэга. 
- `setImage` - метод для установки картинки.
- `setDisabled` - метод для включения/выключения элемента. 
- `render` - метод, который рендарит (отрисовывает) переданные элементы.

## Модель приложения

## Класс AppState 
### Один из основных классов приложения, отвечает за хранение большого количества состояний (каталог, корзина). Также имеет методы, которые отвечаеют за добавление, удаление товара из корзины. Очистка корзины полностью. Также делает ресет для полей инпутов. 

#### Поля Класса:

- `catalog` - Список товаров на главной странице
- `cart` - Список товаров в корзине
- `order` - Список товаров в заказе
- `preview` - Просмотр товара по ID

#### Методы: 

- `addCart` - добавляет товар в корзину.
- `removeCart` - удаляет товар из корзины.
- `updateCart` - обновляет корзину, при изменении (добавлении/удалении).
- `clearCart` - очищает содержимое корзины, в случае успешной покупки. 
- `countTotalPrice` - считает общую стоимость корзины.
- `setPreview` - для отображения товара по id
- `orderReset`- очищает контент заполненный в инпуты
- `contactReset`- очищает контент заполненный в инпуты

## Список событий
- `basket:add` - Добавление товара в корзину.
- `formErrors:change` - Изменение ошибок валидации формы.
- `order:open` - Открытие формы заказа.



## Сервисный класс - ApiWebLarek
### Обеспечивает взаимодействие с серверной частью приложения. Необходим для получения данных о товарах и отправляет заказ на сервер.

#### Методы:
- `getItems` - получение товаров с бекенда.
- `orderRequest` - отправка заказа на сервер.

## Класс представления

## Класс Card
### Отображает и управляет карточками товаров. Класс card также относится к слою представления (View) приложения и является родительским для всех видов карточек. Он отвечает за отображение карточки товара. Задает карточке данные о категории товара, заголовок, изображение, цена и описание. Класс наследуется от родительского класса `Component`.

#### Поля Класса:

- id: Уникальный идентификатор карточки.
- title: Заголовок карточки.
- dicription: Описание карточки.
- category: Категория карточки.
- price: Цена товара.
- image: Изображение товара.

#### Методы: 

- `setId` - принимает строку в качестве параметра и добавляет это значение в свойство dataset у HTML элемента 
- `setTitle` - отвечает за установку текста заголовка карточки.
- `setImage` - отвечает за установку изображения карточки.
- `setDescription` - отвечает за установку текста описания карточки.
- `setCategory` - отвечает за установку категории карточки.
- `setPrice` - отвечает за установку цены товара.

## Класс Cart
### Управление корзиной.

#### Поля Класса:

- \_list: Коллеция товров.
- \_priceTotal: Общая сумма товаров в корзине.
- \_button: Кнопка оформления заказа.

#### Методы:

- `setItems` - добавление товара в корзину в качестве HTML элемента. Если в корзине нет товаров, блокирует кнопку.
- `setPriceTotal` - устанавливает полную стоимость товаров. 

## Класс Order 
### Управляет формой заказа с адресом и способами оплаты

#### Поля класса: 

- \_payment - способ оплаты.
- \_address - адрес доставки.

#### Методы: 

- `updateErrors`: Отрисовка ошибки.
- `clearFieldPayment`: Очистка поля способа оплаты.
- `setAddress`: установка значения адреса из инпута.
- `setPayment`: установка значения способа оплаты при нажатии на кнопку пользователем.
- `setValid`: валидация полей.

## Класс Contact
### Управляет формой заказа, где происходит ввод телефона и эл. почты

#### Поля класса:

- \_email: HTMLInputElement - поле ввода для электронной почты. 
- \_phone: HTMLInputElement - поле ввода для номера телефона. 

#### Методы: 

- `updateErrors`: Отрисовка ошибки.
- `setPhone` - установка значения номера телефона из инпута.
- `setEmail` - установка значения эл. почты из инпута.
- `setValid`: валидация полей.

## Класс Success
### Класс Success отвечает за отрисовку сообщения при успешном заказе.

#### Поля класса:

- \_totalPrice - общая стоимость корзины.
- \_closeButton - закрытие корзины. 

#### Методы:

- `setTotal`: Отображение общей стоимости.
- `render`: для отображения модального окна.

## Класс Modal
### Класс для отображения модального окна покупателю. Добавляет обработчик событий на закрытие (клик вне модального окна / клик на кнопку закрытия).

#### Поля класса:

- \_ modalCloseBtn: HTML элемент для закрытия модального окна.
- \_ modalContent: контейнер для содержимого модального окна.

#### Методы:

- `events` - брокер событий (открытие/закрытие).

## Класс Page
### Класс page относится к слою View приложения. Предназначен для управления визуальной частью страницы, а также каталогом товаров, в том числе счетчиком страницы. Этот класс предначен для управления элементами страницы, обрабатывает события, изменяет визуальное представление в зависимости от страницы. 

#### Поля класса:

-\_counter - количество товаров в корзине.
-\_catalog - товары на главной странице.
-\_basket - корзина товаров на главной странице.

#### Методы: 

- `setCatalog` - принимает массив HTML элементов и делает перерисовку дочерних элементов.
- `openCart` - добавляет обработчик событий на открытие корзины.
- `setCounter` - устанавливает текст в поле с количеством товара.
- `lockPage` - добавляет класс для отключения выхода из модального окна при запросе к серверу. 

